' ============================================
' FLINK COMPLETE LED & POWER SYSTEM CALCULATOR
' Integrated HanleyLED Module Selection & Power Supply Configuration
' Single comprehensive tool for complete electrical specification
' ============================================

Option Explicit

' LED Module Type with Power Requirements
Private Type LEDModuleComplete
    Name As String
    Series As String
    Voltage As Integer
    Wattage As Double
    Lumens As Double
    Efficacy As Double
    ModulesPerFoot As Double
    MaxCascadeSingle As Integer
    MaxCascadeDouble As Integer
    PowerSupplyModel As String
    PowerSupplyCount As Integer
End Type

' Complete System Configuration
Private Type SystemConfiguration
    SelectedModule As LEDModuleComplete
    TotalModules As Long
    TotalLength As Double
    TotalWattage As Double
    TotalLumens As Double
    StrokeCoverage As Double
    CascadeRuns As Integer
    ModulesPerRun As Integer
    PowerSupplyModel As String
    PowerSupplyCount As Integer
    TotalPowerCapacity As Double
    PowerUtilization As Double
    EnclosuresRequired As Integer
End Type

' ============================================
' MAIN INTEGRATED LED & POWER CALCULATOR
' ============================================
Sub FlinkLEDPowerSystem()
    Dim sr As ShapeRange
    Dim totalArea As Double
    Dim config As SystemConfiguration
    
    ' Check selection
    If ActiveSelectionRange.Count = 0 Then
        MsgBox "Select channel letters first!", vbExclamation, "Flink LED & Power System"
        Exit Sub
    End If
    
    Set sr = ActiveSelectionRange
    
    ' Calculate area
    totalArea = CalculateTotalArea(sr)
    
    ' Get specifications through wizard
    config = RunSystemWizard(totalArea, sr)
    
    ' Display comprehensive report
    DisplaySystemReport config
    
    ' Export options
    If MsgBox("Export complete system specification?", vbYesNo + vbQuestion) = vbYes Then
        ExportSystemSpecification config
    End If
End Sub

' ============================================
' SYSTEM CONFIGURATION WIZARD
' ============================================
Function RunSystemWizard(area As Double, sr As ShapeRange) As SystemConfiguration
    Dim config As SystemConfiguration
    Dim channelDepth As Integer
    Dim letterHeight As String
    Dim voltagePreference As String
    Dim installType As String
    
    ' Step 1: Channel specifications
    channelDepth = GetChannelDepth()
    letterHeight = DetermineLetterHeight(sr)
    
    ' Step 2: Electrical preferences
    voltagePreference = GetVoltagePreference()
    installType = GetInstallationType()
    
    ' Step 3: Calculate optimal configuration
    config = CalculateOptimalSystem(area, channelDepth, letterHeight, voltagePreference, installType)
    
    RunSystemWizard = config
End Function

' ============================================
' GET VOLTAGE PREFERENCE
' ============================================
Function GetVoltagePreference() As String
    Dim msg As String
    Dim choice As String
    
    msg = "Select voltage preference:" & vbCrLf & vbCrLf
    msg = msg & "1 = Auto (Optimize efficiency)" & vbCrLf
    msg = msg & "2 = 12 VDC only" & vbCrLf
    msg = msg & "3 = 24 VDC only" & vbCrLf & vbCrLf
    msg = msg & "24V recommended for runs over 50 feet"
    
    choice = InputBox(msg, "Flink Voltage Selection", "1")
    
    Select Case choice
        Case "2"
            GetVoltagePreference = "12V"
        Case "3"
            GetVoltagePreference = "24V"
        Case Else
            GetVoltagePreference = "Auto"
    End Select
End Function

' ============================================
' GET INSTALLATION TYPE
' ============================================
Function GetInstallationType() As String
    Dim msg As String
    Dim choice As String
    
    msg = "Select power feed type:" & vbCrLf & vbCrLf
    msg = msg & "1 = Single-ended feed" & vbCrLf
    msg = msg & "2 = Double-ended feed" & vbCrLf
    msg = msg & "3 = Halo/Reverse lit" & vbCrLf
    
    choice = InputBox(msg, "Flink Installation Type", "1")
    
    Select Case choice
        Case "2"
            GetInstallationType = "Double"
        Case "3"
            GetInstallationType = "Halo"
        Case Else
            GetInstallationType = "Single"
    End Select
End Function

' ============================================
' CALCULATE OPTIMAL SYSTEM
' ============================================
Function CalculateOptimalSystem(area As Double, depth As Integer, height As String, _
    voltage As String, installType As String) As SystemConfiguration
    
    Dim modules() As LEDModuleComplete
    Dim bestConfig As SystemConfiguration
    Dim currentConfig As SystemConfiguration
    Dim bestScore As Double
    Dim i As Integer
    
    ' Load complete module database
    modules = LoadCompleteModuleDatabase()
    
    bestScore = -1
    
    ' Evaluate each suitable module
    For i = 0 To UBound(modules)
        If IsModuleSuitable(modules(i), height, voltage) Then
            currentConfig = CalculateConfiguration(modules(i), area, depth, installType)
            
            ' Score the configuration
            Dim score As Double
            score = ScoreConfiguration(currentConfig)
            
            If score > bestScore Then
                bestScore = score
                bestConfig = currentConfig
            End If
        End If
    Next i
    
    CalculateOptimalSystem = bestConfig
End Function

' ============================================
' LOAD COMPLETE MODULE DATABASE
' ============================================
Function LoadCompleteModuleDatabase() As LEDModuleComplete()
    Dim modules(7) As LEDModuleComplete
    
    ' NRG Mini 1 (12V) - For tiny letters
    With modules(0)
        .Name = "NRG Mini 1"
        .Series = "NRG"
        .Voltage = 12
        .Wattage = 0.36
        .Lumens = 76
        .Efficacy = 165
        .ModulesPerFoot = 4.4
        .MaxCascadeSingle = 50
        .MaxCascadeDouble = 100
    End With
    
    ' NRG Mini 1 Pro (24V) - For tiny letters
    With modules(1)
        .Name = "NRG Mini 1 Pro"
        .Series = "NRG"
        .Voltage = 24
        .Wattage = 0.36
        .Lumens = 59
        .Efficacy = 165
        .ModulesPerFoot = 4.4
        .MaxCascadeSingle = 75
        .MaxCascadeDouble = 150
    End With
    
    ' NRG 2 Pro (24V) - Small to medium
    With modules(2)
        .Name = "NRG 2 Pro"
        .Series = "NRG"
        .Voltage = 24
        .Wattage = 0.62
        .Lumens = 105
        .Efficacy = 170
        .ModulesPerFoot = 1.77
        .MaxCascadeSingle = 80
        .MaxCascadeDouble = 160
    End With
    
    ' Phoenix 2 (12V) - Versatile
    With modules(3)
        .Name = "Phoenix 2"
        .Series = "Phoenix"
        .Voltage = 12
        .Wattage = 0.8
        .Lumens = 91
        .Efficacy = 114
        .ModulesPerFoot = 1.74
        .MaxCascadeSingle = 60
        .MaxCascadeDouble = 120
    End With
    
    ' NRG 3 Pro (24V) - Medium to large
    With modules(4)
        .Name = "NRG 3 Pro"
        .Series = "NRG"
        .Voltage = 24
        .Wattage = 1#
        .Lumens = 170
        .Efficacy = 170
        .ModulesPerFoot = 1.45
        .MaxCascadeSingle = 40
        .MaxCascadeDouble = 80
    End With
    
    ' Phoenix 3 (12V) - Large letters
    With modules(5)
        .Name = "Phoenix 3"
        .Series = "Phoenix"
        .Voltage = 12
        .Wattage = 1.2
        .Lumens = 137
        .Efficacy = 114
        .ModulesPerFoot = 1.48
        .MaxCascadeSingle = 40
        .MaxCascadeDouble = 80
    End With
    
    ' NRG 4 Pro (24V) - Extra bright
    With modules(6)
        .Name = "NRG 4 Pro"
        .Series = "NRG"
        .Voltage = 24
        .Wattage = 1.44
        .Lumens = 244
        .Efficacy = 170
        .ModulesPerFoot = 1.27
        .MaxCascadeSingle = 40
        .MaxCascadeDouble = 80
    End With
    
    ' Spectrum RGB-W (12V) - Color changing
    With modules(7)
        .Name = "Spectrum RGB-W"
        .Series = "Spectrum"
        .Voltage = 12
        .Wattage = 0.92
        .Lumens = 68
        .Efficacy = 73
        .ModulesPerFoot = 1.5
        .MaxCascadeSingle = 60
        .MaxCascadeDouble = 120
    End With
    
    LoadCompleteModuleDatabase = modules
End Function

' ============================================
' CHECK MODULE SUITABILITY
' ============================================
Function IsModuleSuitable(module As LEDModuleComplete, height As String, voltage As String) As Boolean
    ' Check voltage preference
    If voltage <> "Auto" Then
        If module.Voltage <> CInt(Left(voltage, 2)) Then
            IsModuleSuitable = False
            Exit Function
        End If
    End If
    
    ' Check height suitability
    Select Case height
        Case "tiny"
            IsModuleSuitable = (module.ModulesPerFoot > 3)
        Case "small"
            IsModuleSuitable = (module.ModulesPerFoot > 1.5)
        Case "medium"
            IsModuleSuitable = (module.ModulesPerFoot > 1.2 And module.ModulesPerFoot < 2)
        Case "large", "xlarge"
            IsModuleSuitable = (module.ModulesPerFoot <= 1.5)
        Case Else
            IsModuleSuitable = True
    End Select
End Function

' ============================================
' CALCULATE COMPLETE CONFIGURATION
' ============================================
Function CalculateConfiguration(module As LEDModuleComplete, area As Double, _
    depth As Integer, installType As String) As SystemConfiguration
    
    Dim config As SystemConfiguration
    Dim coverage As Double
    Dim maxCascade As Integer
    
    ' Set module
    config.SelectedModule = module
    
    ' Calculate coverage
    coverage = CalculateStrokeCoverage(depth, module.ModulesPerFoot)
    config.StrokeCoverage = coverage
    
    ' Calculate modules needed
    config.TotalModules = CLng(WorksheetFunction.Ceiling(area / (coverage / 12 / module.ModulesPerFoot), 1))
    
    ' Adjust for halo lighting
    If installType = "Halo" Then
        config.TotalModules = CLng(config.TotalModules * 0.7)
    End If
    
    ' Calculate totals
    config.TotalLength = config.TotalModules / module.ModulesPerFoot
    config.TotalWattage = config.TotalModules * module.Wattage
    config.TotalLumens = config.TotalModules * module.Lumens
    
    ' Calculate cascade runs
    If installType = "Double" Then
        maxCascade = module.MaxCascadeDouble
    Else
        maxCascade = module.MaxCascadeSingle
    End If
    
    config.CascadeRuns = CLng(WorksheetFunction.Ceiling(config.TotalModules / maxCascade, 1))
    config.ModulesPerRun = CLng(WorksheetFunction.Ceiling(config.TotalModules / config.CascadeRuns, 1))
    
    ' Calculate power supply requirements
    CalculatePowerSupplyComplete config
    
    CalculateConfiguration = config
End Function

' ============================================
' CALCULATE COMPLETE POWER SUPPLY
' ============================================
Sub CalculatePowerSupplyComplete(ByRef config As SystemConfiguration)
    Dim safetyFactor As Double
    Dim requiredCapacity As Double
    
    safetyFactor = 0.8
    requiredCapacity = config.TotalWattage / safetyFactor
    
    If config.SelectedModule.Voltage = 12 Then
        ' 12V system
        If requiredCapacity <= 60 Then
            config.PowerSupplyModel = "H60W-SD-12"
            config.PowerSupplyCount = 1
            config.TotalPowerCapacity = 60
            config.EnclosuresRequired = 1
        ElseIf requiredCapacity <= 120 Then
            config.PowerSupplyModel = "H120W-SD-12"
            config.PowerSupplyCount = 1
            config.TotalPowerCapacity = 120
            config.EnclosuresRequired = 1
        ElseIf requiredCapacity <= 180 Then
            ' Mixed configuration
            config.PowerSupplyModel = "1×H120W + 1×H60W"
            config.PowerSupplyCount = 2
            config.TotalPowerCapacity = 180
            config.EnclosuresRequired = 2
        Else
            ' Multiple H120W
            config.PowerSupplyCount = CLng(WorksheetFunction.Ceiling(requiredCapacity / 120, 1))
            config.PowerSupplyModel = config.PowerSupplyCount & "×H120W-SD-12"
            config.TotalPowerCapacity = config.PowerSupplyCount * 120
            config.EnclosuresRequired = config.PowerSupplyCount
        End If
    Else
        ' 24V system
        If requiredCapacity <= 96 Then
            config.PowerSupplyModel = "H96W-SD-24"
            config.PowerSupplyCount = 1
            config.TotalPowerCapacity = 96
            config.EnclosuresRequired = 1
        Else
            config.PowerSupplyCount = CLng(WorksheetFunction.Ceiling(requiredCapacity / 96, 1))
            config.PowerSupplyModel = config.PowerSupplyCount & "×H96W-SD-24"
            config.TotalPowerCapacity = config.PowerSupplyCount * 96
            config.EnclosuresRequired = config.PowerSupplyCount
        End If
    End If
    
    ' Calculate utilization
    config.PowerUtilization = (config.TotalWattage / config.TotalPowerCapacity) * 100
End Sub

' ============================================
' SCORE CONFIGURATION
' ============================================
Function ScoreConfiguration(config As SystemConfiguration) As Double
    Dim score As Double
    
    ' Efficacy score (0-40)
    score = (config.SelectedModule.Efficacy / 170) * 40
    
    ' Power utilization score (0-30)
    If config.PowerUtilization >= 70 And config.PowerUtilization <= 80 Then
        score = score + 30
    ElseIf config.PowerUtilization >= 60 And config.PowerUtilization <= 85 Then
        score = score + 20
    Else
        score = score + 10
    End If
    
    ' Voltage efficiency (0-20)
    If config.SelectedModule.Voltage = 24 And config.TotalWattage > 100 Then
        score = score + 20
    ElseIf config.SelectedModule.Voltage = 12 And config.TotalWattage <= 100 Then
        score = score + 20
    Else
        score = score + 10
    End If
    
    ' Enclosure efficiency (0-10)
    score = score + WorksheetFunction.Max(0, 10 - config.EnclosuresRequired)
    
    ScoreConfiguration = score
End Function

' ============================================
' DISPLAY COMPREHENSIVE SYSTEM REPORT
' ============================================
Sub DisplaySystemReport(config As SystemConfiguration)
    Dim report As String
    
    report = "FLINK COMPLETE LED & POWER SYSTEM REPORT" & vbCrLf
    report = report & String(50, "=") & vbCrLf & vbCrLf
    
    ' LED Module Section
    report = report & "LED MODULE CONFIGURATION:" & vbCrLf
    report = report & "Selected Module: " & config.SelectedModule.Name & vbCrLf
    report = report & "Series: " & config.SelectedModule.Series & vbCrLf
    report = report & "Voltage: " & config.SelectedModule.Voltage & " VDC" & vbCrLf
    report = report & "Efficacy: " & config.SelectedModule.Efficacy & " lm/W" & vbCrLf & vbCrLf
    
    report = report & "MODULE REQUIREMENTS:" & vbCrLf
    report = report & "Total Modules: " & config.TotalModules & vbCrLf
    report = report & "Total Length: " & Format(config.TotalLength, "0.0") & " ft" & vbCrLf
    report = report & "Stroke Coverage: " & Format(config.StrokeCoverage, "0") & " inches" & vbCrLf & vbCrLf
    
    report = report & "ELECTRICAL SPECIFICATIONS:" & vbCrLf
    report = report & "Total Wattage: " & Format(config.TotalWattage, "0.0") & "W" & vbCrLf
    report = report & "Total Lumens: " & Format(config.TotalLumens, "0") & " lm" & vbCrLf & vbCrLf
    
    ' Power Supply Section
    report = report & "POWER SUPPLY CONFIGURATION:" & vbCrLf
    report = report & "Model(s): " & config.PowerSupplyModel & vbCrLf
    report = report & "Total Capacity: " & config.TotalPowerCapacity & "W" & vbCrLf
    report = report & "Load Factor: " & Format(config.PowerUtilization, "0.0") & "%" & vbCrLf
    report = report & "Enclosures Required: " & config.EnclosuresRequired & vbCrLf & vbCrLf
    
    ' Wiring Configuration
    report = report & "WIRING CONFIGURATION:" & vbCrLf
    report = report & "Cascade Runs: " & config.CascadeRuns & vbCrLf
    report = report & "Modules per Run: " & config.ModulesPerRun & vbCrLf
    report = report & "Max Allowed: " & IIf(config.CascadeRuns = 1, _
        config.SelectedModule.MaxCascadeSingle, config.SelectedModule.MaxCascadeDouble) & vbCrLf & vbCrLf
    
    ' Installation Notes
    report = report & "INSTALLATION REQUIREMENTS:" & vbCrLf
    report = report & "• UL 48 Spacing: 1"" end-to-end, 4"" side-to-side" & vbCrLf
    report = report & "• Operating Temperature: -40°C to +60°C" & vbCrLf
    report = report & "• IP68/IP65 rated components" & vbCrLf
    report = report & "• Class 2 wiring methods" & vbCrLf & vbCrLf
    
    ' Efficiency Analysis
    If config.PowerUtilization >= 70 And config.PowerUtilization <= 80 Then
        report = report & "✓ OPTIMAL POWER UTILIZATION (70-80%)" & vbCrLf
    ElseIf config.PowerUtilization < 60 Then
        report = report & "⚠ LOW POWER UTILIZATION - Consider smaller supply" & vbCrLf
    ElseIf config.PowerUtilization > 85 Then
        report = report & "⚠ HIGH POWER UTILIZATION - Consider larger supply" & vbCrLf
    End If
    
    MsgBox report, vbInformation, "Flink LED & Power System"
End Sub

' ============================================
' QUICK SYSTEM CHECK
' ============================================
Sub FlinkQuickSystemCheck()
    Dim area As Double
    Dim wattage As Double
    Dim msg As String
    
    If ActiveSelectionRange.Count = 0 Then
        MsgBox "Select shapes first!"
        Exit Sub
    End If
    
    area = CalculateTotalArea(ActiveSelectionRange)
    
    ' Quick estimates
    msg = "QUICK LED & POWER ESTIMATE" & vbCrLf & vbCrLf
    msg = msg & "Face Area: " & Format(area, "0.0") & " sq ft" & vbCrLf & vbCrLf
    
    msg = msg & "TYPICAL CONFIGURATIONS:" & vbCrLf
    msg = msg & "Small Letters (NRG 2 Pro):" & vbCrLf
    msg = msg & "  Modules: " & CLng(area / 0.5) & vbCrLf
    msg = msg & "  Power: " & Format((area / 0.5) * 0.62, "0") & "W" & vbCrLf
    msg = msg & "  Supply: " & IIf((area / 0.5) * 0.62 < 76, "1×H96W-SD-24", "Multiple") & vbCrLf & vbCrLf
    
    msg = msg & "Medium Letters (NRG 3 Pro):" & vbCrLf
    msg = msg & "  Modules: " & CLng(area / 0.7) & vbCrLf
    msg = msg & "  Power: " & Format((area / 0.7) * 1#, "0") & "W" & vbCrLf
    msg = msg & "  Supply: " & IIf((area / 0.7) * 1# < 76, "1×H96W-SD-24", "Multiple") & vbCrLf & vbCrLf
    
    msg = msg & "Large Letters (Phoenix 3):" & vbCrLf
    msg = msg & "  Modules: " & CLng(area / 0.8) & vbCrLf
    msg = msg & "  Power: " & Format((area / 0.8) * 1.2, "0") & "W" & vbCrLf
    msg = msg & "  Supply: " & IIf((area / 0.8) * 1.2 < 96, "1×H120W-SD-12", "Multiple")
    
    MsgBox msg, vbInformation, "Flink Quick Estimate"
End Sub

' ============================================
' EXPORT COMPLETE SYSTEM SPECIFICATION
' ============================================
Sub ExportSystemSpecification(config As SystemConfiguration)
    Dim filePath As String
    Dim content As String
    
    filePath = "C:\FlinkReports\System_Spec_" & Format(Now, "yyyymmdd_hhmmss") & ".csv"
    
    ' Build CSV content
    content = "FLINK LED & POWER SYSTEM SPECIFICATION" & vbCrLf
    content = content & "Generated," & Now & vbCrLf & vbCrLf
    
    content = content & "Category,Item,Value,Unit" & vbCrLf
    content = content & "LED Module,Model," & config.SelectedModule.Name & "," & vbCrLf
    content = content & "LED Module,Voltage," & config.SelectedModule.Voltage & ",VDC" & vbCrLf
    content = content & "LED Module,Quantity," & config.TotalModules & ",modules" & vbCrLf
    content = content & "LED Module,Total Length," & Format(config.TotalLength, "0.00") & ",ft" & vbCrLf
    content = content & "LED Module,Total Wattage," & Format(config.TotalWattage, "0.00") & ",W" & vbCrLf
    content = content & "LED Module,Total Lumens," & Format(config.TotalLumens, "0") & ",lm" & vbCrLf
    content = content & "Power Supply,Model," & config.PowerSupplyModel & "," & vbCrLf
    content = content & "Power Supply,Quantity," & config.PowerSupplyCount & ",units" & vbCrLf
    content = content & "Power Supply,Total Capacity," & config.TotalPowerCapacity & ",W" & vbCrLf
    content = content & "Power Supply,Utilization," & Format(config.PowerUtilization, "0.0") & ",%" & vbCrLf
    content = content & "Power Supply,Enclosures," & config.EnclosuresRequired & ",units" & vbCrLf
    content = content & "Wiring,Cascade Runs," & config.CascadeRuns & ",runs" & vbCrLf
    content = content & "Wiring,Modules per Run," & config.ModulesPerRun & ",modules" & vbCrLf
    
    On Error Resume Next
    MkDir "C:\FlinkReports"
    On Error GoTo 0
    
    Open filePath For Output As #1
    Print #1, content
    Close #1
    
    MsgBox "System specification exported to:" & vbCrLf & filePath, vbInformation, "Flink Sign Pro"
End Sub

' ============================================
' CREATE SYSTEM TOOLBAR
' ============================================
Sub CreateFlinkSystemToolbar()
    MsgBox "FLINK LED & POWER SYSTEM TOOLBAR" & vbCrLf & vbCrLf & _
           "Add these macros to your toolbar:" & vbCrLf & vbCrLf & _
           "• FlinkLEDPowerSystem - Complete calculator" & vbCrLf & _
           "• FlinkQuickSystemCheck - Quick estimates" & vbCrLf & _
           "• FlinkRGBCalculator - RGB module calc" & vbCrLf & _
           "• FlinkPowerDiagram - Visual layout" & vbCrLf & vbCrLf & _
           "Right-click toolbar → Customize → Commands → Macros", _
           vbInformation, "Toolbar Setup"
End Sub

' ============================================
' POWER SUPPLY LAYOUT DIAGRAM
' ============================================
Sub FlinkPowerDiagram()
    Dim config As SystemConfiguration
    Dim diagram As String
    Dim textShape As Shape
    
    If ActiveSelectionRange.Count = 0 Then
        MsgBox "Run LED calculation first!"
        Exit Sub
    End If
    
    ' Run quick calculation
    config = CalculateOptimalSystem(CalculateTotalArea(ActiveSelectionRange), 5, "medium", "Auto", "Single")
    
    ' Create visual diagram
    diagram = "POWER SUPPLY ENCLOSURE LAYOUT" & vbCrLf
    diagram = diagram & String(40, "=") & vbCrLf & vbCrLf
    
    diagram = diagram & "Configuration: " & config.PowerSupplyModel & vbCrLf & vbCrLf
    
    ' Visual representation
    If config.SelectedModule.Voltage = 12 Then
        If InStr(config.PowerSupplyModel, "H60W") > 0 Then
            diagram = diagram & "[H60W] [H60W]  ← Max 2 per enclosure" & vbCrLf
            diagram = diagram & "  4""     4""   ← Side spacing" & vbCrLf
        End If
        If InStr(config.PowerSupplyModel, "H120W") > 0 Then
            diagram = diagram & "[  H120W  ]    ← Max 1 per enclosure" & vbCrLf
        End If
    Else
        diagram = diagram & "[  H96W  ]     ← Max 1 per enclosure" & vbCrLf
    End If
    
    diagram = diagram & vbCrLf & "UL 48 SPACING REQUIREMENTS:" & vbCrLf
    diagram = diagram & "• 1"" minimum end-to-end" & vbCrLf
    diagram = diagram & "• 4"" minimum side-to-side" & vbCrLf
    diagram = diagram & "• Adequate ventilation required" & vbCrLf & vbCrLf
    
    diagram = diagram & "Load: " & Format(config.PowerUtilization, "0.0") & "%" & vbCrLf
    diagram = diagram & "Enclosures: " & config.EnclosuresRequired
    
    ' Create text shape
    Set textShape = ActiveLayer.CreateArtisticText(0, ActiveDocument.SizeHeight, diagram)
    textShape.Text.FontProperties.Size = 10
    textShape.Text.FontProperties.Name = "Courier New"
End Sub