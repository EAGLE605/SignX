<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flink LED & Power System Calculator - HanleyLED Integration</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            color: #2c3e50;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #2c3e50 0%, #27ae60 100%);
            color: white;
            padding: 40px 0;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 30px;
            margin-top: 30px;
        }
        
        .panel {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        
        .panel h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #27ae60;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
            font-size: 0.95em;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #27ae60;
            background: white;
            box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1);
        }
        
        .btn {
            background: #27ae60;
            color: white;
            padding: 12px 30px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-top: 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
            display: inline-block;
            width: 100%;
        }
        
        .btn:hover {
            background: #229954;
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(39, 174, 96, 0.4);
        }
        
        .results-container {
            display: grid;
            gap: 20px;
        }
        
        .result-card {
            background: #f8f9fa;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .result-card.primary {
            border-color: #27ae60;
            background: #e8f5e9;
        }
        
        .result-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .voltage-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
            background: #3498db;
            color: white;
        }
        
        .voltage-badge.v24 {
            background: #e74c3c;
        }
        
        .spec-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .spec-item {
            background: white;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #e1e8ed;
        }
        
        .spec-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 4px;
        }
        
        .spec-value {
            font-size: 1.1em;
            font-weight: 700;
            color: #2c3e50;
        }
        
        .power-supply-section {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border: 2px solid #3498db;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .power-supply-section h4 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .ps-recommendation {
            background: white;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 10px;
            border: 2px solid #3498db;
        }
        
        .ps-recommendation.optimal {
            border-color: #27ae60;
            background: #f0fff4;
        }
        
        .ps-specs {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9em;
        }
        
        .enclosure-visual {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-top: 15px;
        }
        
        .power-supply-icon {
            display: inline-block;
            width: 80px;
            height: 120px;
            background: #6c757d;
            border-radius: 4px;
            margin: 5px;
            position: relative;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            font-weight: bold;
        }
        
        .power-supply-icon.h60w {
            background: #28a745;
        }
        
        .power-supply-icon.h96w {
            background: #17a2b8;
        }
        
        .power-supply-icon.h120w {
            background: #dc3545;
        }
        
        .spacing-note {
            background: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
            padding: 12px;
            border-radius: 5px;
            margin-top: 15px;
            font-size: 0.9em;
        }
        
        .module-visual {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .module-icon {
            width: 40px;
            height: 12px;
            background: #333;
            border-radius: 2px;
            position: relative;
        }
        
        .module-icon::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 6px;
            height: 6px;
            background: white;
            border-radius: 50%;
            box-shadow: -12px 0 0 white, 12px 0 0 white;
        }
        
        .cascade-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #2196f3;
        }
        
        .summary-section {
            background: #2c3e50;
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin-top: 20px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .summary-item {
            text-align: center;
        }
        
        .summary-value {
            font-size: 2em;
            font-weight: 700;
            color: #27ae60;
        }
        
        .summary-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        .export-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .application-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            background: #e9ecef;
            padding: 5px;
            border-radius: 8px;
        }
        
        .tab-btn {
            flex: 1;
            padding: 10px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 6px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .tab-btn:hover {
            background: rgba(255,255,255,0.5);
        }
        
        .tab-btn.active {
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            font-size: 0.9em;
        }
        
        .comparison-table th,
        .comparison-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #e1e8ed;
        }
        
        .comparison-table th {
            background: #2c3e50;
            color: white;
            font-weight: 600;
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .comparison-table tr:hover {
            background: #f8f9fa;
        }
        
        .comparison-table .selected-row {
            background: #e8f5e9;
            font-weight: 600;
        }
        
        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .spec-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Flink LED & Power System Calculator</h1>
            <p class="subtitle">Complete HanleyLED Module Selection & Power Supply Configuration</p>
        </div>
    </header>
    
    <div class="container">
        <div class="main-grid">
            <!-- Input Panel -->
            <div class="panel">
                <h2>Sign Specifications</h2>
                
                <div class="application-tabs">
                    <button class="tab-btn active" onclick="setApplication('channel')">Channel Letters</button>
                    <button class="tab-btn" onclick="setApplication('cabinet')">Cabinet Sign</button>
                    <button class="tab-btn" onclick="setApplication('rgb')">RGB</button>
                </div>
                
                <div class="form-group">
                    <label>Total Face Area (sq ft)</label>
                    <input type="number" id="faceArea" step="0.1" placeholder="80" value="80">
                </div>
                
                <div class="form-group">
                    <label>Channel/Cabinet Depth (inches)</label>
                    <select id="channelDepth">
                        <option value="3">3"</option>
                        <option value="4">4"</option>
                        <option value="5" selected>5"</option>
                        <option value="6">6"</option>
                        <option value="8">8"</option>
                        <option value="10">10"</option>
                        <option value="12">12"</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Letter Height Range</label>
                    <select id="letterHeight">
                        <option value="tiny">Under 6" (Tiny serifs)</option>
                        <option value="small">6" - 12"</option>
                        <option value="medium" selected>12" - 24"</option>
                        <option value="large">24" - 48"</option>
                        <option value="xlarge">Over 48"</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Voltage Preference</label>
                    <select id="voltagePreference">
                        <option value="auto">Auto (Optimize)</option>
                        <option value="12">12 VDC Only</option>
                        <option value="24">24 VDC Only</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Installation Type</label>
                    <select id="installationType">
                        <option value="single">Single-sided</option>
                        <option value="double">Double-sided</option>
                        <option value="halo">Halo/Reverse Lit</option>
                    </select>
                </div>
                
                <button class="btn" onclick="calculateSystem()">Calculate LED & Power Requirements</button>
            </div>
            
            <!-- Results Panel -->
            <div class="panel">
                <h2>System Configuration Results</h2>
                
                <div id="resultsContainer" class="results-container">
                    <!-- Results will be populated here -->
                </div>
                
                <div class="export-buttons" style="display: none;" id="exportButtons">
                    <button class="btn btn-secondary" onclick="printResults()">Print Report</button>
                    <button class="btn btn-secondary" onclick="exportToCSV()">Export CSV</button>
                    <button class="btn" onclick="saveConfiguration()">Save Configuration</button>
                </div>
            </div>
        </div>
        
        <!-- Module Comparison -->
        <div class="panel" id="comparisonPanel" style="display: none;">
            <h2>LED Module Options Comparison</h2>
            <table class="comparison-table" id="comparisonTable">
                <!-- Comparison table will be populated here -->
            </table>
        </div>
    </div>
    
    <script>
        // HanleyLED module database
        const ledModules = {
            'nrg-mini-1': {
                name: 'NRG Mini 1',
                series: 'NRG',
                voltage: 12,
                wattage: 0.36,
                lumens: 76,
                efficacy: 165,
                modulesPerFoot: 4.4,
                lumensPerFoot: 174,
                maxCascade: { single: 50, double: 100 },
                bestFor: ['tiny', 'small'],
                applications: ['channel'],
                color: '7000K'
            },
            'nrg-mini-1-pro': {
                name: 'NRG Mini 1 Pro',
                series: 'NRG',
                voltage: 24,
                wattage: 0.36,
                lumens: 59,
                efficacy: 165,
                modulesPerFoot: 4.4,
                lumensPerFoot: 261,
                maxCascade: { single: 75, double: 150 },
                bestFor: ['tiny', 'small'],
                applications: ['channel'],
                color: '7000K'
            },
            'nrg-2-pro': {
                name: 'NRG 2 Pro',
                series: 'NRG',
                voltage: 24,
                wattage: 0.62,
                lumens: 105,
                efficacy: 170,
                modulesPerFoot: 1.77,
                lumensPerFoot: 185,
                maxCascade: { single: 80, double: 160 },
                bestFor: ['small', 'medium'],
                applications: ['channel'],
                color: '7000K'
            },
            'phoenix-2': {
                name: 'Phoenix 2',
                series: 'Phoenix',
                voltage: 12,
                wattage: 0.8,
                lumens: 91,
                efficacy: 114,
                modulesPerFoot: 1.74,
                lumensPerFoot: 158,
                maxCascade: { single: 60, double: 120 },
                bestFor: ['small', 'medium'],
                applications: ['channel', 'cabinet'],
                color: '7000K'
            },
            'nrg-3-pro': {
                name: 'NRG 3 Pro',
                series: 'NRG',
                voltage: 24,
                wattage: 1.0,
                lumens: 170,
                efficacy: 170,
                modulesPerFoot: 1.45,
                lumensPerFoot: 246,
                maxCascade: { single: 40, double: 80 },
                bestFor: ['medium', 'large'],
                applications: ['channel', 'cabinet'],
                color: '7000K'
            },
            'phoenix-3': {
                name: 'Phoenix 3',
                series: 'Phoenix',
                voltage: 12,
                wattage: 1.2,
                lumens: 137,
                efficacy: 114,
                modulesPerFoot: 1.48,
                lumensPerFoot: 202.76,
                maxCascade: { single: 40, double: 80 },
                bestFor: ['medium', 'large'],
                applications: ['channel', 'cabinet'],
                color: '7000K'
            },
            'nrg-4-pro': {
                name: 'NRG 4 Pro',
                series: 'NRG',
                voltage: 24,
                wattage: 1.44,
                lumens: 244,
                efficacy: 170,
                modulesPerFoot: 1.27,
                lumensPerFoot: 309,
                maxCascade: { single: 40, double: 80 },
                bestFor: ['large', 'xlarge'],
                applications: ['channel', 'cabinet'],
                color: '7000K'
            },
            'spectrum-rgbw': {
                name: 'Spectrum RGB-W',
                series: 'Spectrum',
                voltage: 12,
                wattage: 0.92,
                lumens: 68,
                efficacy: 73,
                modulesPerFoot: 1.5,
                lumensPerFoot: 102,
                maxCascade: { single: 60, double: 120 },
                bestFor: ['small', 'medium', 'large'],
                applications: ['rgb'],
                color: 'RGBW'
            }
        };
        
        // HanleyLED power supplies
        const powerSupplies = {
            12: [
                { model: 'H60W-SD-12', wattage: 60, maxPerEnclosure: 2, efficiency: 0.86 },
                { model: 'H120W-SD-12', wattage: 120, maxPerEnclosure: 1, efficiency: 0.87, dualOutput: true }
            ],
            24: [
                { model: 'H96W-SD-24', wattage: 96, maxPerEnclosure: 1, efficiency: 0.87 }
            ]
        };
        
        let currentApplication = 'channel';
        let systemConfiguration = null;
        
        function setApplication(app) {
            currentApplication = app;
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update form based on application
            if (app === 'rgb') {
                document.getElementById('voltagePreference').value = '12';
                document.getElementById('installationType').value = 'single';
            }
        }
        
        function calculateSystem() {
            const faceArea = parseFloat(document.getElementById('faceArea').value) || 0;
            const channelDepth = parseInt(document.getElementById('channelDepth').value);
            const letterHeight = document.getElementById('letterHeight').value;
            const voltagePreference = document.getElementById('voltagePreference').value;
            const installationType = document.getElementById('installationType').value;
            
            // Find suitable modules
            const suitableModules = findSuitableModules();
            
            // Calculate requirements for each module
            const configurations = suitableModules.map(module => {
                return calculateModuleConfiguration(module, faceArea, channelDepth, installationType);
            });
            
            // Sort by efficiency score
            configurations.sort((a, b) => b.efficiencyScore - a.efficiencyScore);
            
            // Display results
            displayResults(configurations);
            
            // Store the best configuration
            systemConfiguration = configurations[0];
        }
        
        function findSuitableModules() {
            const letterHeight = document.getElementById('letterHeight').value;
            const voltagePreference = document.getElementById('voltagePreference').value;
            const suitable = [];
            
            for (const [key, module] of Object.entries(ledModules)) {
                // Check application
                if (!module.applications.includes(currentApplication)) continue;
                
                // Check letter height
                if (currentApplication !== 'rgb' && !module.bestFor.includes(letterHeight)) continue;
                
                // Check voltage preference
                if (voltagePreference !== 'auto') {
                    if (module.voltage !== parseInt(voltagePreference)) continue;
                }
                
                suitable.push({ key, ...module });
            }
            
            return suitable;
        }
        
        function calculateModuleConfiguration(module, faceArea, channelDepth, installationType) {
            // Calculate coverage
            const coverage = getModuleCoverage(channelDepth, module.modulesPerFoot);
            
            // Calculate module requirements
            let totalModules = Math.ceil(faceArea / coverage.sqFtPerModule);
            if (installationType === 'halo') {
                totalModules = Math.ceil(totalModules * 0.7); // Halo requires fewer modules
            }
            
            const totalLength = totalModules / module.modulesPerFoot;
            const totalWattage = totalModules * module.wattage;
            const totalLumens = totalModules * module.lumens;
            
            // Calculate power supply requirements
            const powerConfig = calculateOptimalPowerSupply(totalWattage, module.voltage);
            
            // Calculate cascade runs
            const cascadeRuns = calculateCascadeRuns(totalModules, module.maxCascade, installationType);
            
            // Calculate efficiency score
            const efficiencyScore = calculateEfficiencyScore(module, powerConfig, totalWattage);
            
            return {
                module: module,
                totalModules: totalModules,
                totalLength: totalLength,
                totalWattage: totalWattage,
                totalLumens: totalLumens,
                coverage: coverage,
                powerSupply: powerConfig,
                cascadeRuns: cascadeRuns,
                efficiencyScore: efficiencyScore
            };
        }
        
        function getModuleCoverage(channelDepth, modulesPerFoot) {
            let strokeCoverage = 9;
            let rowSpacing = 6;
            
            if (channelDepth <= 3) {
                strokeCoverage = 6;
                rowSpacing = 4;
            } else if (channelDepth <= 4) {
                strokeCoverage = 9;
                rowSpacing = 6;
            } else if (channelDepth <= 6) {
                strokeCoverage = 12;
                rowSpacing = 8;
            } else {
                strokeCoverage = 15;
                rowSpacing = 10;
            }
            
            // Adjust for module density
            if (modulesPerFoot > 3) {
                strokeCoverage *= 0.75;
            } else if (modulesPerFoot < 1.5) {
                strokeCoverage *= 1.2;
            }
            
            const sqFtPerModule = (strokeCoverage / 12) / modulesPerFoot;
            
            return {
                strokeCoverage: strokeCoverage,
                rowSpacing: rowSpacing,
                sqFtPerModule: sqFtPerModule
            };
        }
        
        function calculateOptimalPowerSupply(totalWattage, voltage) {
            const safetyFactor = 0.8;
            const requiredCapacity = totalWattage / safetyFactor;
            const available = powerSupplies[voltage];
            
            let bestConfig = null;
            let bestUtilization = 0;
            
            // Try single supply options
            for (const ps of available) {
                if (ps.wattage >= requiredCapacity) {
                    const utilization = (totalWattage / ps.wattage) * 100;
                    if (utilization > 60 && utilization <= 80) {
                        bestConfig = {
                            supplies: [{ ...ps, count: 1 }],
                            totalCapacity: ps.wattage,
                            utilization: utilization,
                            enclosures: 1
                        };
                        bestUtilization = Math.abs(75 - utilization); // Optimal at 75%
                    }
                }
            }
            
            // Try multiple supplies if needed
            if (!bestConfig) {
                for (const ps of available) {
                    const count = Math.ceil(requiredCapacity / ps.wattage);
                    const totalCapacity = count * ps.wattage;
                    const utilization = (totalWattage / totalCapacity) * 100;
                    
                    const enclosures = Math.ceil(count / ps.maxPerEnclosure);
                    
                    if (!bestConfig || Math.abs(75 - utilization) < bestUtilization) {
                        bestConfig = {
                            supplies: [{ ...ps, count: count }],
                            totalCapacity: totalCapacity,
                            utilization: utilization,
                            enclosures: enclosures
                        };
                        bestUtilization = Math.abs(75 - utilization);
                    }
                }
            }
            
            // Try mixed configuration for 12V
            if (voltage === 12 && totalWattage > 60) {
                const h120 = available.find(ps => ps.model === 'H120W-SD-12');
                const h60 = available.find(ps => ps.model === 'H60W-SD-12');
                
                if (h120 && h60) {
                    const h120Count = Math.floor(requiredCapacity / 120);
                    const remaining = requiredCapacity - (h120Count * 120);
                    const h60Count = Math.ceil(remaining / 60);
                    
                    const totalCapacity = (h120Count * 120) + (h60Count * 60);
                    const utilization = (totalWattage / totalCapacity) * 100;
                    
                    if (utilization > 60 && utilization <= 85) {
                        const enclosures = h120Count + Math.ceil(h60Count / 2);
                        
                        if (Math.abs(75 - utilization) < bestUtilization) {
                            bestConfig = {
                                supplies: [
                                    { ...h120, count: h120Count },
                                    { ...h60, count: h60Count }
                                ].filter(s => s.count > 0),
                                totalCapacity: totalCapacity,
                                utilization: utilization,
                                enclosures: enclosures,
                                mixed: true
                            };
                        }
                    }
                }
            }
            
            return bestConfig;
        }
        
        function calculateCascadeRuns(totalModules, maxCascade, installationType) {
            const maxModules = installationType === 'double' ? maxCascade.double : maxCascade.single;
            const runs = Math.ceil(totalModules / maxModules);
            const modulesPerRun = Math.ceil(totalModules / runs);
            
            return {
                runs: runs,
                modulesPerRun: modulesPerRun,
                maxAllowed: maxModules,
                type: installationType === 'double' ? 'Double-ended' : 'Single-ended'
            };
        }
        
        function calculateEfficiencyScore(module, powerConfig, totalWattage) {
            let score = 0;
            
            // Module efficacy (0-40 points)
            score += (module.efficacy / 170) * 40;
            
            // Power utilization (0-30 points)
            const utilization = powerConfig.utilization;
            if (utilization >= 70 && utilization <= 80) {
                score += 30;
            } else if (utilization >= 60 && utilization <= 85) {
                score += 20;
            } else {
                score += 10;
            }
            
            // Voltage efficiency (0-20 points)
            if (module.voltage === 24 && totalWattage > 100) {
                score += 20; // 24V is better for larger systems
            } else if (module.voltage === 12 && totalWattage <= 100) {
                score += 20; // 12V is fine for smaller systems
            } else {
                score += 10;
            }
            
            // Enclosure efficiency (0-10 points)
            score += Math.max(0, 10 - powerConfig.enclosures);
            
            return score;
        }
        
        function displayResults(configurations) {
            const container = document.getElementById('resultsContainer');
            container.innerHTML = '';
            
            // Create comparison table
            createComparisonTable(configurations);
            
            // Display top 3 configurations
            configurations.slice(0, 3).forEach((config, index) => {
                const card = createConfigurationCard(config, index === 0);
                container.appendChild(card);
            });
            
            // Show export buttons
            document.getElementById('exportButtons').style.display = 'flex';
            document.getElementById('comparisonPanel').style.display = 'block';
            
            // Add summary section
            if (configurations.length > 0) {
                const summary = createSummarySection(configurations[0]);
                container.appendChild(summary);
            }
        }
        
        function createConfigurationCard(config, isPrimary) {
            const card = document.createElement('div');
            card.className = 'result-card' + (isPrimary ? ' primary' : '');
            
            const powerSupplyText = config.powerSupply.supplies
                .map(s => `${s.count} × ${s.model}`)
                .join(' + ');
            
            card.innerHTML = `
                <h3>
                    ${config.module.name} ${isPrimary ? '(Recommended)' : ''}
                    <span class="voltage-badge ${config.module.voltage === 24 ? 'v24' : ''}">${config.module.voltage}V</span>
                </h3>
                
                <div class="spec-grid">
                    <div class="spec-item">
                        <div class="spec-label">Total Modules</div>
                        <div class="spec-value">${config.totalModules}</div>
                    </div>
                    <div class="spec-item">
                        <div class="spec-label">Total Length</div>
                        <div class="spec-value">${config.totalLength.toFixed(1)} ft</div>
                    </div>
                    <div class="spec-item">
                        <div class="spec-label">Total Wattage</div>
                        <div class="spec-value">${config.totalWattage.toFixed(1)}W</div>
                    </div>
                    <div class="spec-item">
                        <div class="spec-label">Total Lumens</div>
                        <div class="spec-value">${config.totalLumens.toFixed(0)} lm</div>
                    </div>
                </div>
                
                <div class="power-supply-section">
                    <h4>Power Supply Configuration</h4>
                    <div class="ps-recommendation ${config.powerSupply.utilization >= 70 && config.powerSupply.utilization <= 80 ? 'optimal' : ''}">
                        <strong>${powerSupplyText}</strong>
                        <div class="ps-specs">
                            <span>Capacity: ${config.powerSupply.totalCapacity}W</span>
                            <span>Load: ${config.powerSupply.utilization.toFixed(1)}%</span>
                            <span>Enclosures: ${config.powerSupply.enclosures}</span>
                        </div>
                    </div>
                    ${createEnclosureVisual(config.powerSupply)}
                </div>
                
                <div class="cascade-info">
                    <strong>Wiring Configuration:</strong><br>
                    ${config.cascadeRuns.runs} runs × ${config.cascadeRuns.modulesPerRun} modules<br>
                    ${config.cascadeRuns.type} power feed<br>
                    Max allowed: ${config.cascadeRuns.maxAllowed} modules
                </div>
                
                ${isPrimary ? createModuleVisual(config.totalModules, config.module) : ''}
            `;
            
            return card;
        }
        
        function createEnclosureVisual(powerConfig) {
            let html = '<div class="enclosure-visual">';
            
            powerConfig.supplies.forEach(supply => {
                for (let i = 0; i < supply.count; i++) {
                    let iconClass = 'power-supply-icon';
                    if (supply.model.includes('60W')) iconClass += ' h60w';
                    else if (supply.model.includes('96W')) iconClass += ' h96w';
                    else if (supply.model.includes('120W')) iconClass += ' h120w';
                    
                    html += `<div class="${iconClass}">${supply.model.replace('H', '').replace('-SD-12', '').replace('-SD-24', '')}</div>`;
                }
            });
            
            html += '</div>';
            html += '<div class="spacing-note">⚠️ UL 48 Spacing: 1" end-to-end, 4" side-to-side minimum</div>';
            
            return html;
        }
        
        function createModuleVisual(totalModules, module) {
            const maxShow = 30;
            const showCount = Math.min(totalModules, maxShow);
            
            let html = '<div class="module-visual">';
            for (let i = 0; i < showCount; i++) {
                html += '<div class="module-icon"></div>';
            }
            
            if (totalModules > maxShow) {
                html += `<div style="width: 100%; text-align: center; margin-top: 10px;">... and ${totalModules - maxShow} more modules</div>`;
            }
            
            html += '</div>';
            return html;
        }
        
        function createComparisonTable(configurations) {
            const table = document.getElementById('comparisonTable');
            
            let html = `
                <thead>
                    <tr>
                        <th>LED Module</th>
                        <th>Series</th>
                        <th>Voltage</th>
                        <th>Modules</th>
                        <th>Wattage</th>
                        <th>Lumens</th>
                        <th>Power Supply</th>
                        <th>Load %</th>
                        <th>Score</th>
                    </tr>
                </thead>
                <tbody>
            `;
            
            configurations.forEach((config, index) => {
                const powerSupplyText = config.powerSupply.supplies
                    .map(s => `${s.count}×${s.model.replace('H', '').replace('-SD-', '@')}`)
                    .join('+');
                
                html += `
                    <tr class="${index === 0 ? 'selected-row' : ''}">
                        <td>${config.module.name}</td>
                        <td>${config.module.series}</td>
                        <td>${config.module.voltage}V</td>
                        <td>${config.totalModules}</td>
                        <td>${config.totalWattage.toFixed(0)}W</td>
                        <td>${config.totalLumens.toFixed(0)}</td>
                        <td>${powerSupplyText}</td>
                        <td>${config.powerSupply.utilization.toFixed(0)}%</td>
                        <td>${config.efficiencyScore.toFixed(0)}</td>
                    </tr>
                `;
            });
            
            html += '</tbody>';
            table.innerHTML = html;
        }
        
        function createSummarySection(config) {
            const summary = document.createElement('div');
            summary.className = 'summary-section';
            
            summary.innerHTML = `
                <h3>Complete System Summary</h3>
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="summary-value">${config.totalModules}</div>
                        <div class="summary-label">LED Modules</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${config.totalLength.toFixed(0)}</div>
                        <div class="summary-label">Total Feet</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${config.totalWattage.toFixed(0)}W</div>
                        <div class="summary-label">Total Power</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${config.powerSupply.enclosures}</div>
                        <div class="summary-label">Enclosures</div>
                    </div>
                </div>
            `;
            
            return summary;
        }
        
        function printResults() {
            window.print();
        }
        
        function exportToCSV() {
            if (!systemConfiguration) return;
            
            const config = systemConfiguration;
            const powerSupplyText = config.powerSupply.supplies
                .map(s => `${s.count} × ${s.model}`)
                .join(' + ');
            
            let csv = 'Item,Specification,Value,Unit\n';
            csv += `LED Module,${config.module.name},${config.totalModules},modules\n`;
            csv += `Module Length,,${config.totalLength.toFixed(2)},ft\n`;
            csv += `Total Wattage,,${config.totalWattage.toFixed(2)},W\n`;
            csv += `Total Lumens,,${config.totalLumens.toFixed(0)},lm\n`;
            csv += `Power Supply,${powerSupplyText},,\n`;
            csv += `Power Capacity,,${config.powerSupply.totalCapacity},W\n`;
            csv += `Load Percentage,,${config.powerSupply.utilization.toFixed(1)},%\n`;
            csv += `Enclosures Required,,${config.powerSupply.enclosures},units\n`;
            csv += `Cascade Runs,,${config.cascadeRuns.runs},runs\n`;
            csv += `Modules per Run,,${config.cascadeRuns.modulesPerRun},modules\n`;
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Flink_LED_System_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
        }
        
        function saveConfiguration() {
            if (!systemConfiguration) return;
            
            const configData = {
                date: new Date().toISOString(),
                faceArea: document.getElementById('faceArea').value,
                channelDepth: document.getElementById('channelDepth').value,
                configuration: systemConfiguration
            };
            
            localStorage.setItem('flinkLEDConfig_' + Date.now(), JSON.stringify(configData));
            alert('Configuration saved successfully!');
        }
        
        // Initialize with example
        window.onload = function() {
            document.getElementById('faceArea').value = '80';
            calculateSystem();
        };
    </script>
</body>
</html>