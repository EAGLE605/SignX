var e,t;"function"==typeof(e=globalThis.define)&&(t=e,e=null),function(t,r,s,a,i){var o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n="function"==typeof o[a]&&o[a],l=n.cache||{},c="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function u(e,r){if(!l[e]){if(!t[e]){var s="function"==typeof o[a]&&o[a];if(!r&&s)return s(e,!0);if(n)return n(e,!0);if(c&&"string"==typeof e)return c(e);var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}p.resolve=function(r){var s=t[e][1][r];return null!=s?s:r},p.cache={};var h=l[e]=new u.Module(e);t[e][0].call(h.exports,p,h,h.exports,this)}return l[e].exports;function p(e){var t=p.resolve(e);return!1===t?{}:u(t)}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=t,u.cache=l,u.parent=n,u.register=function(e,r){t[e]=[function(e,t){t.exports=r},{}]},Object.defineProperty(u,"root",{get:function(){return o[a]}}),o[a]=u;for(var h=0;h<r.length;h++)u(r[h]);if(s){var p=u(s);"object"==typeof exports&&"undefined"!=typeof module?module.exports=p:"function"==typeof e&&e.amd?e(function(){return p}):i&&(this[i]=p)}}({kgW6q:[function(e,t,r){e("../../../src/background/index")},{"../../../src/background/index":"iqY5N"}],iqY5N:[function(e,t,r){var s=e("@plasmohq/storage"),a=e("~/lib/proxy");let i=new s.Storage({area:"local"});async function o(e){try{let t=await i.get(e);if(null!=t){if("string"==typeof t)try{return JSON.parse(t)}catch{}return t}return null}catch(t){return console.error(`Error getting storage value for ${e}:`,t),null}}async function n(){try{let e=await o("proxyEnabled"),t=await o("proxy_string"),r=!0===e||"true"===e||'"true"'===e;if("string"==typeof t&&(t=t.replace(/^"|"$/g,"")),console.log("Initializing proxy with state:",{proxyEnabled:r,hasProxyString:!!t,proxyString:t?t.replace(/:[^:@]+@/,":****@"):null}),r&&t){let e=await (0,a.proxyManager).setupProxy(t);e.success?(console.log("Proxy initialized successfully with IP:",e.ip),await i.set("proxyStatus",{ip:e.ip,lastVerified:Date.now(),isVerified:!0})):(console.error("Failed to initialize proxy:",e.error),await (0,a.proxyManager).clearProxy(),await i.set("proxyEnabled","false"))}else console.log("Proxy not enabled or no proxy string found"),await (0,a.proxyManager).clearProxy()}catch(e){console.error("Error initializing proxy:",e),await (0,a.proxyManager).clearProxy(),await i.set("proxyEnabled","false"),await i.set("proxyStatus",{error:e.message,lastVerified:Date.now(),isVerified:!1})}}chrome.runtime.onStartup.addListener(()=>{console.log("Extension starting up, initializing proxy..."),n()}),chrome.runtime.onInstalled.addListener(e=>{console.log("Extension installed/updated:",e.reason),n()}),i.watch({proxyEnabled:()=>{console.log("Proxy enabled changed, reinitializing..."),setTimeout(n,100)},proxy_string:()=>{console.log("Proxy string changed, reinitializing..."),setTimeout(n,100)}}),chrome.runtime.onMessage.addListener((e,t,r)=>("SETUP_PROXY"===e.type?(0,a.proxyManager).setupProxy(e.proxyString).then(r).catch(e=>r({success:!1,error:e.message})):"CLEAR_PROXY"===e.type?(0,a.proxyManager).clearProxy().then(()=>r({success:!0})).catch(e=>r({success:!1,error:e.message})):"TEST_PROXY"===e.type?(0,a.proxyManager).setupProxy(e.proxyString).then(r).catch(e=>r({success:!1,error:e.message})):"VERIFY_PROXY"===e.type?(0,a.proxyManager).verifyProxy().then(r).catch(e=>r({success:!1,error:e.message})):r({received:!0}),!0)),chrome.action.onClicked.addListener(async()=>{await (0,a.proxyManager).clearProxy();let e=chrome.runtime.getURL("tabs/products.html"),t=await chrome.tabs.query({url:e});t.length>0?(await chrome.tabs.update(t[0].id,{active:!0}),await chrome.windows.update(t[0].windowId,{focused:!0})):chrome.tabs.create({url:e})})},{"@plasmohq/storage":"8Qr17","~/lib/proxy":"3a1Sf"}],"8Qr17":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"BaseStorage",()=>n),s.export(r,"Storage",()=>l);var a=e("pify"),i=s.interopDefault(a),o=()=>{try{let e=globalThis.navigator?.userAgent.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if("Chrome"===e[1])return 100>parseInt(e[2])||globalThis.chrome.runtime?.getManifest()?.manifest_version===2}catch{}return!1},n=class{#e;#t;get primaryClient(){return this.#t}#r;get secondaryClient(){return this.#r}#s;get area(){return this.#s}get hasWebApi(){try{return"u">typeof window&&!!window.localStorage}catch(e){return console.error(e),!1}}#a=new Map;#i;get copiedKeySet(){return this.#i}isCopied=e=>this.hasWebApi&&(this.allCopied||this.copiedKeySet.has(e));#o=!1;get allCopied(){return this.#o}getExtStorageApi=()=>globalThis.browser?.storage||globalThis.chrome?.storage;get hasExtensionApi(){try{return!!this.getExtStorageApi()}catch(e){return console.error(e),!1}}isWatchSupported=()=>this.hasExtensionApi;keyNamespace="";isValidKey=e=>e.startsWith(this.keyNamespace);getNamespacedKey=e=>`${this.keyNamespace}${e}`;getUnnamespacedKey=e=>e.slice(this.keyNamespace.length);constructor({area:e="sync",allCopied:t=!1,copiedKeyList:r=[]}={}){this.setCopiedKeySet(r),this.#s=e,this.#o=t;try{this.hasWebApi&&(t||r.length>0)&&(this.#r=window.localStorage)}catch{}try{this.hasExtensionApi&&(this.#e=this.getExtStorageApi(),o()?this.#t=(0,i.default)(this.#e[this.area],{exclude:["getBytesInUse"],errorFirst:!1}):this.#t=this.#e[this.area])}catch{}}setCopiedKeySet(e){this.#i=new Set(e)}rawGetAll=()=>this.#t?.get();getAll=async()=>Object.entries(await this.rawGetAll()).filter(([e])=>this.isValidKey(e)).reduce((e,[t,r])=>(e[this.getUnnamespacedKey(t)]=r,e),{});copy=async e=>{let t=void 0===e;if(!t&&!this.copiedKeySet.has(e)||!this.allCopied||!this.hasExtensionApi)return!1;let r=this.allCopied?await this.rawGetAll():await this.#t.get((t?[...this.copiedKeySet]:[e]).map(this.getNamespacedKey));if(!r)return!1;let s=!1;for(let e in r){let t=r[e],a=this.#r?.getItem(e);this.#r?.setItem(e,t),s||=t!==a}return s};rawGet=async e=>this.hasExtensionApi?(await this.#t.get(e))[e]:this.isCopied(e)?this.#r?.getItem(e):null;rawSet=async(e,t)=>(this.isCopied(e)&&this.#r?.setItem(e,t),this.hasExtensionApi&&await this.#t.set({[e]:t}),null);clear=async(e=!1)=>{e&&this.#r?.clear(),await this.#t.clear()};rawRemove=async e=>{this.isCopied(e)&&this.#r?.removeItem(e),this.hasExtensionApi&&await this.#t.remove(e)};removeAll=async()=>{let e=Object.keys(await this.rawGetAll());await Promise.all(e.map(this.rawRemove))};watch=e=>{let t=this.isWatchSupported();return t&&this.#n(e),t};#n=e=>{for(let t in e){let r=this.getNamespacedKey(t),s=this.#a.get(r)?.callbackSet||new Set;if(s.add(e[t]),s.size>1)continue;let a=(e,t)=>{if(t!==this.area||!e[r])return;let s=this.#a.get(r);if(!s)throw Error(`Storage comms does not exist for nsKey: ${r}`);Promise.all([this.parseValue(e[r].newValue),this.parseValue(e[r].oldValue)]).then(([e,r])=>{for(let a of s.callbackSet)a({newValue:e,oldValue:r},t)})};this.#e.onChanged.addListener(a),this.#a.set(r,{callbackSet:s,listener:a})}};unwatch=e=>{let t=this.isWatchSupported();return t&&this.#l(e),t};#l(e){for(let t in e){let r=this.getNamespacedKey(t),s=e[t],a=this.#a.get(r);a&&(a.callbackSet.delete(s),0===a.callbackSet.size&&(this.#a.delete(r),this.#e.onChanged.removeListener(a.listener)))}}unwatchAll=()=>this.#c();#c(){this.#a.forEach(({listener:e})=>this.#e.onChanged.removeListener(e)),this.#a.clear()}async getItem(e){return this.get(e)}async setItem(e,t){await this.set(e,t)}async removeItem(e){return this.remove(e)}},l=class extends n{get=async e=>{let t=this.getNamespacedKey(e),r=await this.rawGet(t);return this.parseValue(r)};set=async(e,t)=>{let r=this.getNamespacedKey(e),s=JSON.stringify(t);return this.rawSet(r,s)};remove=async e=>{let t=this.getNamespacedKey(e);return this.rawRemove(t)};setNamespace=e=>{this.keyNamespace=e};parseValue=async e=>{try{if(void 0!==e)return JSON.parse(e)}catch(e){console.error(e)}}}},{pify:"9arDK","@parcel/transformer-js/src/esmodule-helpers.js":"hbR2Q"}],"9arDK":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);let a=(e,t,r,s)=>function(...a){let i=t.promiseModule;return new i((i,o)=>{t.multiArgs?a.push((...e)=>{t.errorFirst?e[0]?o(e):(e.shift(),i(e)):i(e)}):t.errorFirst?a.push((e,t)=>{e?o(e):i(t)}):a.push(i),Reflect.apply(e,this===r?s:this,a)})},i=new WeakMap;function o(e,t){t={exclude:[/.+(?:Sync|Stream)$/],errorFirst:!0,promiseModule:Promise,...t};let r=typeof e;if(!(null!==e&&("object"===r||"function"===r)))throw TypeError(`Expected \`input\` to be a \`Function\` or \`Object\`, got \`${null===e?"null":r}\``);let s=(e,r)=>{let s=i.get(e);if(s||(s={},i.set(e,s)),r in s)return s[r];let a=e=>"string"==typeof e||"symbol"==typeof r?r===e:e.test(r),o=Reflect.getOwnPropertyDescriptor(e,r),n=void 0===o||o.writable||o.configurable,l=t.include?t.include.some(e=>a(e)):!t.exclude.some(e=>a(e)),c=l&&n;return s[r]=c,c},o=new WeakMap,n=new Proxy(e,{apply(e,r,s){let i=o.get(e);if(i)return Reflect.apply(i,r,s);let l=t.excludeMain?e:a(e,t,n,e);return o.set(e,l),Reflect.apply(l,r,s)},get(e,r){let i=e[r];if(!s(e,r)||i===Function.prototype[r])return i;let l=o.get(i);if(l)return l;if("function"==typeof i){let r=a(i,t,n,e);return o.set(i,r),r}return i}});return n}},{"@parcel/transformer-js/src/esmodule-helpers.js":"hbR2Q"}],hbR2Q:[function(e,t,r){r.interopDefault=function(e){return e&&e.__esModule?e:{default:e}},r.defineInteropFlag=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.exportAll=function(e,t){return Object.keys(e).forEach(function(r){"default"===r||"__esModule"===r||t.hasOwnProperty(r)||Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[r]}})}),t},r.export=function(e,t,r){Object.defineProperty(e,t,{enumerable:!0,get:r})}},{}],"3a1Sf":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"ProxyManager",()=>n),s.export(r,"proxyManager",()=>l);var a=e("@plasmohq/storage");let i=new a.Storage,o=null;class n{constructor(){this.storage=i}static getInstance(){return n.instance||(n.instance=new n),n.instance}parseBrightDataProxy(e){let t=e.match(/^([^:]+):([^@]+)@([^:]+):(\d+)$/);if(t){let[e,r,s,a,i]=t;return{username:r,password:s,host:a,port:parseInt(i,10)}}if(t=e.match(/^([^:]+):(\d+):([^:]+):(.+)$/)){let[e,r,s,a,i]=t;return{username:a,password:i,host:r,port:parseInt(s,10)}}throw Error("Invalid proxy string format. Expected either username:password@host:port or host:port:username:password")}async setupProxy(e){try{let t=this.parseBrightDataProxy(e);await chrome.proxy.settings.set({value:{mode:"fixed_servers",rules:{singleProxy:{scheme:"http",host:t.host,port:t.port}}},scope:"regular"}),this.setupAuthListener(t);let r=await this.testProxy();if(!r.success)throw Error(r.error);return await Promise.all([this.storage.set("proxyEnabled",!0),this.storage.set("proxy_string",e),this.storage.set("proxyStatus",{ip:r.ip,lastVerified:Date.now(),isVerified:!0,error:null})]),{success:!0,ip:r.ip}}catch(e){return await this.clearProxy(),{success:!1,error:e.message}}}async testProxy(){try{let e=await fetch("https://api.ipify.org?format=json",{credentials:"include",mode:"cors",cache:"no-cache"});if(!e.ok)throw Error(`HTTP error! status: ${e.status}`);let t=await e.json();if(!t.ip)throw Error("No IP address returned");return{success:!0,ip:t.ip}}catch(e){return{success:!1,error:e.message}}}async verifyProxy(){try{let e=await this.storage.get("proxyEnabled"),t=await this.storage.get("proxyStatus"),r=Date.now();if(!e)return{success:!1,error:"Proxy not enabled"};if(!t?.lastVerified||r-t.lastVerified>36e5||!t.isVerified){let e=await this.testProxy();return await this.storage.set("proxyStatus",{ip:e.ip,lastVerified:r,isVerified:e.success,error:e.error}),e}return{success:!0,ip:t.ip}}catch(e){return{success:!1,error:e.message}}}async clearProxy(){try{await chrome.proxy.settings.clear({scope:"regular"}),o&&(chrome.webRequest.onAuthRequired.removeListener(o),o=null),await Promise.all([this.storage.remove("proxyEnabled"),this.storage.remove("proxy_string"),this.storage.remove("proxyStatus")])}catch(e){console.error("Error clearing proxy configuration:",e)}}setupAuthListener(e){o&&chrome.webRequest.onAuthRequired.removeListener(o),o=(t,r)=>{r(t.isProxy?{authCredentials:{username:e.username,password:e.password}}:{})},chrome.webRequest.onAuthRequired.addListener(o,{urls:["<all_urls>"]},["asyncBlocking"])}async fetchWithProxy(e,t={}){let r=await this.storage.get("proxyEnabled");if(!r)throw Error("Proxy not enabled");let s=await fetch(e,{...t,credentials:"include",mode:"cors",headers:{...t.headers}});try{let e=await fetch("https://api.ipify.org?format=json",{credentials:"include",mode:"cors",cache:"no-cache"});if(e.ok){let t=await e.json();t.ip&&Object.defineProperty(s,"proxyIp",{value:t.ip,enumerable:!0})}}catch(e){console.error("Failed to get proxy IP:",e)}return s}}let l=n.getInstance()},{"@plasmohq/storage":"8Qr17","@parcel/transformer-js/src/esmodule-helpers.js":"hbR2Q"}]},["kgW6q"],"kgW6q","parcelRequire731c"),globalThis.define=t;